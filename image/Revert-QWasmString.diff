From b24f53090c998d3c96018baf2cd083f8de5056f3 Mon Sep 17 00:00:00 2001
From: Fredrik Orderud <forderud@gmail.com>
Date: Sat, 8 Feb 2020 14:50:45 +0100
Subject: [PATCH] Revert: wasm: fix QWasmString::toQString assertion for
 emscripten 1.39.4

https://codereview.qt-project.org/c/qt/qtbase/+/288433
---
 src/plugins/platforms/wasm/qwasmstring.cpp | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/src/plugins/platforms/wasm/qwasmstring.cpp b/src/plugins/platforms/wasm/qwasmstring.cpp
index b1be405eeb..05b571c459 100644
--- a/src/plugins/platforms/wasm/qwasmstring.cpp
+++ b/src/plugins/platforms/wasm/qwasmstring.cpp
@@ -52,10 +52,9 @@ QString QWasmString::toQString(const val &v)
         val::global("Module")["stringToUTF16"]);
     static const val length("length");
 
-    int len = v[length].as<int>();
-    result.resize(len);
+    result.resize(v[length].as<int>());
     auto ptr = quintptr(result.utf16());
-    stringToUTF16(v, val(ptr), val((len + 1) * 2));
+    stringToUTF16(v, val(ptr));
     return result;
 }
 
-- 
2.22.0.windows.1

